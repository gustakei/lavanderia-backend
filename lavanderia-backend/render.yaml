services:
  - type: web
    name: lavanderia-backend
    env: python
    region: oregon
    plan: free
    buildCommand: |
      # Atualiza pacotes
      apt-get update -y
      
      # Instala dependências do Chrome
      apt-get install -y wget unzip xvfb libxi6 libgconf-2-4 fonts-liberation libappindicator3-1 libasound2 libatk-bridge2.0-0 libatk1.0-0 libcups2 libdbus-1-3 libgbm1 libnspr4 libnss3 libu2f-udev libvulkan1 libxcomposite1 libxdamage1 libxfixes3 libxrandr2 xdg-utils
      
      # Baixa e instala Chrome
      wget -q https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
      dpkg -i google-chrome-stable_current_amd64.deb || apt-get install -f -y
      
      # Pega versão do Chrome
      CHROME_VERSION=$(google-chrome --version | grep -oE '[0-9]+\.[0-9]+\.[0-9]+' | head -1)
      
      # Baixa ChromeDriver compatível
      wget -q https://storage.googleapis.com/chrome-for-testing-public/${CHROME_VERSION}/linux64/chromedriver-linux64.zip
      unzip -q chromedriver-linux64.zip
      mv chromedriver-linux64/chromedriver /usr/local/bin/chromedriver
      chmod +x /usr/local/bin/chromedriver
      
      # Instala Python
      pip install -r requirements.txt
      
    startCommand: gunicorn app:app
    disk:
      name: data
      mountPath: /data
      sizeGB: 1